# 回调<a name="ZH-CN_TOPIC_0208815912"></a>

## 功能介绍<a name="section5584184924715"></a>

用户可以在上传对象请求中设置回调参数，OBS在对象上传成功之后，将上传结果回调特定服务器，并将回调结果返回给用户。

>![](public_sys-resources/icon-note.gif) **说明：**   
>目前只在POST上传对象API中支持回调功能。  
>在对象上传成功之后才会回调特定服务器，如果对象上传失败则不会回调。  
>回调成功，返回回调结果给客户端；回调失败，返回203，表示对象上传成功但是回调失败。  

POST上传对象API中，回调参数可以在表单中携带，也可以在policy中携带。两者只能选择其一。

如果在表单中携带，每个回调参数都需要增加一个表单元素，回调参数可以不做条件校验，即不需要在policy的conditions中增加回调参数。这种方式支持在回调消息体中使用用户自定义变量，自定义变量通过“x:”前缀携带。

如果通过policy携带，则不需要增加表单元素。但是不支持用户自定义变量，仅能使用系统变量。

通过表单携带的回调参数如[表1 表单回调参数](#table10581246192811)所示。

**表 1**  表单回调参数

<a name="table10581246192811"></a>
<table><thead align="left"><tr id="row1059134642817"><th class="cellrowborder" valign="top" width="15.291529152915292%" id="mcps1.2.4.1.1"><p id="p165964615283"><a name="p165964615283"></a><a name="p165964615283"></a>参数名称</p>
</th>
<th class="cellrowborder" valign="top" width="70.83708370837084%" id="mcps1.2.4.1.2"><p id="p1759124611288"><a name="p1759124611288"></a><a name="p1759124611288"></a>描述</p>
</th>
<th class="cellrowborder" valign="top" width="13.87138713871387%" id="mcps1.2.4.1.3"><p id="p859346112817"><a name="p859346112817"></a><a name="p859346112817"></a>是否必选</p>
</th>
</tr>
</thead>
<tbody><tr id="row0591646122812"><td class="cellrowborder" valign="top" width="15.291529152915292%" headers="mcps1.2.4.1.1 "><p id="p135915464288"><a name="p135915464288"></a><a name="p135915464288"></a>callbackUrl</p>
</td>
<td class="cellrowborder" valign="top" width="70.83708370837084%" headers="mcps1.2.4.1.2 "><p id="p1037995217429"><a name="p1037995217429"></a><a name="p1037995217429"></a>对象上传成功之后，OBS向此url发送回调请求，请求方法为POST。</p>
<p id="p188382549423"><a name="p188382549423"></a><a name="p188382549423"></a>支持设置多个url，以英文分号（;）分隔，最多支持10个。</p>
<p id="p6410124012437"><a name="p6410124012437"></a><a name="p6410124012437"></a>callbackUrl需要做url编码。例如：<em id="i1071514520501"><a name="i1071514520501"></a><a name="i1071514520501"></a><span>http://www.example.com/中文?key=中文名</span></em>需要编码成<span>http://www.example.com/%E4%B8%AD%E6%96%87?key=%E4%B8%AD%E6%96%87%E5%90%8D</span></p>
<p id="p26221095214"><a name="p26221095214"></a><a name="p26221095214"></a>类型：字符串。</p>
</td>
<td class="cellrowborder" valign="top" width="13.87138713871387%" headers="mcps1.2.4.1.3 "><p id="p2059124612820"><a name="p2059124612820"></a><a name="p2059124612820"></a>是</p>
</td>
</tr>
<tr id="row359546202817"><td class="cellrowborder" valign="top" width="15.291529152915292%" headers="mcps1.2.4.1.1 "><p id="p459346152813"><a name="p459346152813"></a><a name="p459346152813"></a>callbackHost</p>
</td>
<td class="cellrowborder" valign="top" width="70.83708370837084%" headers="mcps1.2.4.1.2 "><p id="p5591346142817"><a name="p5591346142817"></a><a name="p5591346142817"></a>发起回调请求的Host头域的值，如果不设置，会使用callbackUrl解析出来的Host。</p>
<p id="p452419534200"><a name="p452419534200"></a><a name="p452419534200"></a>类型：字符串。</p>
</td>
<td class="cellrowborder" valign="top" width="13.87138713871387%" headers="mcps1.2.4.1.3 "><p id="p135954682816"><a name="p135954682816"></a><a name="p135954682816"></a>否</p>
</td>
</tr>
<tr id="row159174617288"><td class="cellrowborder" valign="top" width="15.291529152915292%" headers="mcps1.2.4.1.1 "><p id="p205944610281"><a name="p205944610281"></a><a name="p205944610281"></a>callbackBody</p>
</td>
<td class="cellrowborder" valign="top" width="70.83708370837084%" headers="mcps1.2.4.1.2 "><p id="p1859114672814"><a name="p1859114672814"></a><a name="p1859114672814"></a>发起回调请求的body体。body体格式必须符合callbackBodyType中设置的媒体类型。</p>
<p id="p1250362134113"><a name="p1250362134113"></a><a name="p1250362134113"></a>回调body体支持系统变量和自定义变量，系统变量如<a href="#table695016242719">表3 回调body体支持的系统变量</a>所示，自定义变量就是以x:开头的变量。例如：key=$(key)&amp;hash=$(etag)&amp;fileid=${x:fileid}，其中变量key、etag是系统变量，x:fileid是自定义变量。如果用户上传的对象是图片，可以在参数中设置imageInfo.width和imageInfo.height表示该图片的宽高。例如：key=$(key)&amp;hash=$(etag)&amp;w=$(imageInfo.width)&amp;h=$(imageInfo.height)。</p>
<p id="p78921955122014"><a name="p78921955122014"></a><a name="p78921955122014"></a>类型：字符串。</p>
</td>
<td class="cellrowborder" valign="top" width="13.87138713871387%" headers="mcps1.2.4.1.3 "><p id="p115911467285"><a name="p115911467285"></a><a name="p115911467285"></a>是</p>
</td>
</tr>
<tr id="row459134672820"><td class="cellrowborder" valign="top" width="15.291529152915292%" headers="mcps1.2.4.1.1 "><p id="p145964616288"><a name="p145964616288"></a><a name="p145964616288"></a>callbackBodyType</p>
</td>
<td class="cellrowborder" valign="top" width="70.83708370837084%" headers="mcps1.2.4.1.2 "><p id="p2060194652811"><a name="p2060194652811"></a><a name="p2060194652811"></a>发起回调请求的Content-Type头域的值。如果不设置，默认为</p>
<p id="p127231347152014"><a name="p127231347152014"></a><a name="p127231347152014"></a>application/x-www-form-urlencoded。</p>
<p id="p173961546207"><a name="p173961546207"></a><a name="p173961546207"></a>类型：字符串。</p>
</td>
<td class="cellrowborder" valign="top" width="13.87138713871387%" headers="mcps1.2.4.1.3 "><p id="p10603461287"><a name="p10603461287"></a><a name="p10603461287"></a>否</p>
</td>
</tr>
<tr id="row4601446182816"><td class="cellrowborder" valign="top" width="15.291529152915292%" headers="mcps1.2.4.1.1 "><p id="p156094672811"><a name="p156094672811"></a><a name="p156094672811"></a>x:*</p>
</td>
<td class="cellrowborder" valign="top" width="70.83708370837084%" headers="mcps1.2.4.1.2 "><p id="p8601546182815"><a name="p8601546182815"></a><a name="p8601546182815"></a>用户自定义变量，必须以 x: 开头。</p>
</td>
<td class="cellrowborder" valign="top" width="13.87138713871387%" headers="mcps1.2.4.1.3 "><p id="p660164672814"><a name="p660164672814"></a><a name="p660164672814"></a>否</p>
</td>
</tr>
</tbody>
</table>

通过policy携带的回调参数如[表2 policy回调参数](#table33521276338)所示。

**表 2**  policy回调参数

<a name="table33521276338"></a>
<table><thead align="left"><tr id="row113521770337"><th class="cellrowborder" valign="top" width="10.771077107710772%" id="mcps1.2.4.1.1"><p id="p1235277193312"><a name="p1235277193312"></a><a name="p1235277193312"></a>参数名称</p>
</th>
<th class="cellrowborder" valign="top" width="75.31753175317532%" id="mcps1.2.4.1.2"><p id="p935257183313"><a name="p935257183313"></a><a name="p935257183313"></a>描述</p>
</th>
<th class="cellrowborder" valign="top" width="13.91139113911391%" id="mcps1.2.4.1.3"><p id="p1135213743312"><a name="p1135213743312"></a><a name="p1135213743312"></a>是否必选</p>
</th>
</tr>
</thead>
<tbody><tr id="row15352197163312"><td class="cellrowborder" valign="top" width="10.771077107710772%" headers="mcps1.2.4.1.1 "><p id="p12352973337"><a name="p12352973337"></a><a name="p12352973337"></a>url</p>
</td>
<td class="cellrowborder" valign="top" width="75.31753175317532%" headers="mcps1.2.4.1.2 "><p id="p14476119182315"><a name="p14476119182315"></a><a name="p14476119182315"></a>对象上传成功之后，OBS向此url发送回调请求，请求方法为POST。</p>
<p id="p1247761910235"><a name="p1247761910235"></a><a name="p1247761910235"></a>支持设置多个url，以英文分号（;）分隔，最多支持10个。</p>
<p id="p1147716198236"><a name="p1147716198236"></a><a name="p1147716198236"></a>url需要做url编码。例如：<em id="i174777199230"><a name="i174777199230"></a><a name="i174777199230"></a><span>http://www.example.com/中文?key=中文名</span></em>需要编码成<span>http://www.example.com/%E4%B8%AD%E6%96%87?key=%E4%B8%AD%E6%96%87%E5%90%8D</span></p>
<p id="p1747731911237"><a name="p1747731911237"></a><a name="p1747731911237"></a>类型：字符串。</p>
</td>
<td class="cellrowborder" valign="top" width="13.91139113911391%" headers="mcps1.2.4.1.3 "><p id="p14352127103318"><a name="p14352127103318"></a><a name="p14352127103318"></a>是</p>
</td>
</tr>
<tr id="row14352187183313"><td class="cellrowborder" valign="top" width="10.771077107710772%" headers="mcps1.2.4.1.1 "><p id="p53525713336"><a name="p53525713336"></a><a name="p53525713336"></a>host</p>
</td>
<td class="cellrowborder" valign="top" width="75.31753175317532%" headers="mcps1.2.4.1.2 "><p id="p37181329122312"><a name="p37181329122312"></a><a name="p37181329122312"></a>发起回调请求的Host头域的值，如果不设置，会使用url解析出来的Host。</p>
<p id="p0718529122316"><a name="p0718529122316"></a><a name="p0718529122316"></a>类型：字符串。</p>
</td>
<td class="cellrowborder" valign="top" width="13.91139113911391%" headers="mcps1.2.4.1.3 "><p id="p1435207163317"><a name="p1435207163317"></a><a name="p1435207163317"></a>否</p>
</td>
</tr>
<tr id="row193522743312"><td class="cellrowborder" valign="top" width="10.771077107710772%" headers="mcps1.2.4.1.1 "><p id="p1035217793313"><a name="p1035217793313"></a><a name="p1035217793313"></a>body</p>
</td>
<td class="cellrowborder" valign="top" width="75.31753175317532%" headers="mcps1.2.4.1.2 "><p id="p62271436112311"><a name="p62271436112311"></a><a name="p62271436112311"></a>发起回调请求的body体。body体格式必须符合body-type中设置的媒体类型。</p>
<p id="p722716363232"><a name="p722716363232"></a><a name="p722716363232"></a>body的内容必须经过URL安全base64编码。</p>
<p id="p1322763620239"><a name="p1322763620239"></a><a name="p1322763620239"></a>回调body体支持使用系统变量，系统变量如<a href="#table695016242719">表3 回调body体支持的系统变量</a>所示。例如：key=$(key)&amp;hash=$(etag)，其中变量key、etag是系统变量，则body参数为：a2V5PSQoa2V5KSZoYXNoPSQoZXRhZyk=，是key=$(key)&amp;hash=$(etag)的base64编码。如果用户上传的对象是图片，可以在参数中设置imageInfo.width和imageInfo.height表示该图片的宽高。例如：key=$(key)&amp;hash=$(etag)&amp;w=$(imageInfo.width)&amp;h=$(imageInfo.height)，body参数为：a2V5PSQoa2V5KSZoYXNoPSQoZXRhZykmdz0kKGltYWdlSW5mby53aWR0aCkmaD0kKGltYWdlSW5mby5oZWlnaHQp</p>
<p id="p02271936162318"><a name="p02271936162318"></a><a name="p02271936162318"></a>类型：字符串。</p>
</td>
<td class="cellrowborder" valign="top" width="13.91139113911391%" headers="mcps1.2.4.1.3 "><p id="p63537713333"><a name="p63537713333"></a><a name="p63537713333"></a>是</p>
</td>
</tr>
<tr id="row163532713314"><td class="cellrowborder" valign="top" width="10.771077107710772%" headers="mcps1.2.4.1.1 "><p id="p33530763310"><a name="p33530763310"></a><a name="p33530763310"></a>body-type</p>
</td>
<td class="cellrowborder" valign="top" width="75.31753175317532%" headers="mcps1.2.4.1.2 "><p id="p1566583316239"><a name="p1566583316239"></a><a name="p1566583316239"></a>发起回调请求的Content-Type头域的值。如果不设置，默认为</p>
<p id="p19665113315238"><a name="p19665113315238"></a><a name="p19665113315238"></a>application/x-www-form-urlencoded。</p>
<p id="p266503392320"><a name="p266503392320"></a><a name="p266503392320"></a>类型：字符串。</p>
</td>
<td class="cellrowborder" valign="top" width="13.91139113911391%" headers="mcps1.2.4.1.3 "><p id="p14353117103312"><a name="p14353117103312"></a><a name="p14353117103312"></a>否</p>
</td>
</tr>
</tbody>
</table>

**表 3**  回调body体支持的系统变量

<a name="table695016242719"></a>
<table><thead align="left"><tr id="row139517242715"><th class="cellrowborder" valign="top" width="25.452545254525454%" id="mcps1.2.4.1.1"><p id="p5516105431320"><a name="p5516105431320"></a><a name="p5516105431320"></a>变量名称</p>
</th>
<th class="cellrowborder" valign="top" width="19.09190919091909%" id="mcps1.2.4.1.2"><p id="p65161654121313"><a name="p65161654121313"></a><a name="p65161654121313"></a>参数类型</p>
</th>
<th class="cellrowborder" valign="top" width="55.45554555455545%" id="mcps1.2.4.1.3"><p id="p1851715548135"><a name="p1851715548135"></a><a name="p1851715548135"></a>描述</p>
</th>
</tr>
</thead>
<tbody><tr id="row159511224274"><td class="cellrowborder" valign="top" width="25.452545254525454%" headers="mcps1.2.4.1.1 "><p id="p47745595"><a name="p47745595"></a><a name="p47745595"></a>fname</p>
</td>
<td class="cellrowborder" valign="top" width="19.09190919091909%" headers="mcps1.2.4.1.2 "><p id="p49510241371"><a name="p49510241371"></a><a name="p49510241371"></a>String</p>
</td>
<td class="cellrowborder" valign="top" width="55.45554555455545%" headers="mcps1.2.4.1.3 "><p id="p195117244716"><a name="p195117244716"></a><a name="p195117244716"></a>上传的原始文件名。</p>
</td>
</tr>
<tr id="row8951724277"><td class="cellrowborder" valign="top" width="25.452545254525454%" headers="mcps1.2.4.1.1 "><p id="p26397691"><a name="p26397691"></a><a name="p26397691"></a>fsize</p>
</td>
<td class="cellrowborder" valign="top" width="19.09190919091909%" headers="mcps1.2.4.1.2 "><p id="p209511924377"><a name="p209511924377"></a><a name="p209511924377"></a>String</p>
</td>
<td class="cellrowborder" valign="top" width="55.45554555455545%" headers="mcps1.2.4.1.3 "><p id="p13951924473"><a name="p13951924473"></a><a name="p13951924473"></a>文件的大小，单位为字节。</p>
<p id="p1269173818482"><a name="p1269173818482"></a><a name="p1269173818482"></a><span>名称兼容size。</span></p>
</td>
</tr>
<tr id="row1815201412474"><td class="cellrowborder" valign="top" width="25.452545254525454%" headers="mcps1.2.4.1.1 "><p id="p16638299"><a name="p16638299"></a><a name="p16638299"></a>etag</p>
</td>
<td class="cellrowborder" valign="top" width="19.09190919091909%" headers="mcps1.2.4.1.2 "><p id="p168161714194717"><a name="p168161714194717"></a><a name="p168161714194717"></a>String</p>
</td>
<td class="cellrowborder" valign="top" width="55.45554555455545%" headers="mcps1.2.4.1.3 "><p id="p98166145475"><a name="p98166145475"></a><a name="p98166145475"></a>对象的ETag。</p>
</td>
</tr>
<tr id="row683974165019"><td class="cellrowborder" valign="top" width="25.452545254525454%" headers="mcps1.2.4.1.1 "><p id="p1839184175018"><a name="p1839184175018"></a><a name="p1839184175018"></a>bucket</p>
</td>
<td class="cellrowborder" valign="top" width="19.09190919091909%" headers="mcps1.2.4.1.2 "><p id="p1583915495017"><a name="p1583915495017"></a><a name="p1583915495017"></a>String</p>
</td>
<td class="cellrowborder" valign="top" width="55.45554555455545%" headers="mcps1.2.4.1.3 "><p id="p48396413501"><a name="p48396413501"></a><a name="p48396413501"></a>上传的对象所属桶名。</p>
</td>
</tr>
<tr id="row5646182815010"><td class="cellrowborder" valign="top" width="25.452545254525454%" headers="mcps1.2.4.1.1 "><p id="p46461828135016"><a name="p46461828135016"></a><a name="p46461828135016"></a>key</p>
</td>
<td class="cellrowborder" valign="top" width="19.09190919091909%" headers="mcps1.2.4.1.2 "><p id="p864612817502"><a name="p864612817502"></a><a name="p864612817502"></a>String</p>
</td>
<td class="cellrowborder" valign="top" width="55.45554555455545%" headers="mcps1.2.4.1.3 "><p id="p964652813507"><a name="p964652813507"></a><a name="p964652813507"></a>上传的对象名。</p>
</td>
</tr>
<tr id="row2013391819479"><td class="cellrowborder" valign="top" width="25.452545254525454%" headers="mcps1.2.4.1.1 "><p id="p7932225"><a name="p7932225"></a><a name="p7932225"></a>ext</p>
</td>
<td class="cellrowborder" valign="top" width="19.09190919091909%" headers="mcps1.2.4.1.2 "><p id="p101339189477"><a name="p101339189477"></a><a name="p101339189477"></a>String</p>
</td>
<td class="cellrowborder" valign="top" width="55.45554555455545%" headers="mcps1.2.4.1.3 "><p id="p66652164"><a name="p66652164"></a><a name="p66652164"></a>上传文件的后缀名，通过自动检测的mimeType或者$(fname)的后缀来获取。</p>
<p id="p78591336165014"><a name="p78591336165014"></a><a name="p78591336165014"></a><span>名称兼容mimeType。</span></p>
</td>
</tr>
<tr id="row228324164511"><td class="cellrowborder" valign="top" width="25.452545254525454%" headers="mcps1.2.4.1.1 "><p id="p64255597"><a name="p64255597"></a><a name="p64255597"></a>imageInfo</p>
</td>
<td class="cellrowborder" valign="top" width="19.09190919091909%" headers="mcps1.2.4.1.2 "><p id="p8602177154619"><a name="p8602177154619"></a><a name="p8602177154619"></a>String</p>
</td>
<td class="cellrowborder" valign="top" width="55.45554555455545%" headers="mcps1.2.4.1.3 "><p id="p3089614"><a name="p3089614"></a><a name="p3089614"></a>获取所上传图片的基本信息。只支持上传图片的场景。</p>
<p id="p27806530"><a name="p27806530"></a><a name="p27806530"></a>该变量包含$(imageInfo.width)和$(imageInfo.height)两个子字段，分别表示图片的宽度和高度。</p>
</td>
</tr>
</tbody>
</table>

## 请求消息样式<a name="section920472595517"></a>

通过表单携带回调参数的请求消息样式与POST上传对象相同，参考[5.4.2POST上传](POST上传.md)。policy的内容包含失效时间和条件元素，参考[3.2.4基于浏览器上传的表单中携带签名](基于浏览器上传的表单中携带签名.md)。

通过policy携带回调参数的policy如下所示，比普通的policy增加了回调参数“callback”。请求消息样式与POST上传对象相同，参考[POST上传](POST上传.md)。

```
{ "expiration": "2017-12-31T12:00:00.000Z",
  "conditions": [
    {"x-obs-acl": "public-read" },
    {"x-obs-security-token": "YwkaRTbdY8g7q...." },
    {"bucket": "book" },
    ["starts-with", "$key", "user/"]
  ],
  "callback": [
    {"url": "http://www.example.com/callback" },
    {"host": "www.example.com" },
    {"body": "eyJrZXkiOiIkKGtleSkiLCJoYXNoIjoiJChldGFnKSJ9"},
    {"body-type": "application/json"}
  ]
}
```

## 响应消息样式<a name="section1315310151095"></a>

```
HTTP/1.1 status_code
Content-Type: type
Server: OBS
Date: date
x-obs-request-id: request-id 
Content-Length: length
```

## 返回码<a name="section9636819142316"></a>

带回调参数的POST上传对象的返回码与普通POST上传对象不同。普通POST上传对象HTTP状态码是“204 No Content”。带回调参数的POST上传对象返回结果是回调结果，如果回调成功，一般会返回“200 OK”，如果回调失败，会返回203。

**表 4**  回调请求返回码

<a name="table126951511235"></a>
<table><thead align="left"><tr id="row187012151233"><th class="cellrowborder" valign="top" width="37.49%" id="mcps1.2.3.1.1"><p id="p6701915122320"><a name="p6701915122320"></a><a name="p6701915122320"></a>HTTP状态码</p>
</th>
<th class="cellrowborder" valign="top" width="62.51%" id="mcps1.2.3.1.2"><p id="p197041516237"><a name="p197041516237"></a><a name="p197041516237"></a>说明</p>
</th>
</tr>
</thead>
<tbody><tr id="row16334132622813"><td class="cellrowborder" valign="top" width="37.49%" headers="mcps1.2.3.1.1 "><p id="p1033532618283"><a name="p1033532618283"></a><a name="p1033532618283"></a>200 OK</p>
</td>
<td class="cellrowborder" valign="top" width="62.51%" headers="mcps1.2.3.1.2 "><p id="p333542611289"><a name="p333542611289"></a><a name="p333542611289"></a>上传对象成功，并且回调成功。</p>
</td>
</tr>
<tr id="row117031510238"><td class="cellrowborder" valign="top" width="37.49%" headers="mcps1.2.3.1.1 "><p id="p415237172614"><a name="p415237172614"></a><a name="p415237172614"></a>203 Non Authoritative Information</p>
</td>
<td class="cellrowborder" valign="top" width="62.51%" headers="mcps1.2.3.1.2 "><p id="p117112159234"><a name="p117112159234"></a><a name="p117112159234"></a>上传对象成功，但是回调失败。</p>
</td>
</tr>
</tbody>
</table>

## 请求示例<a name="section1972213514918"></a>

下面的几张表提供了一些回调请求的示例。

**表 5**  通过policy携带回调参数

<a name="table71585163526"></a>
<table><thead align="left"><tr id="row2015811695217"><th class="cellrowborder" valign="top" width="62.46000000000001%" id="mcps1.2.3.1.1"><p id="p1215961614529"><a name="p1215961614529"></a><a name="p1215961614529"></a>请求</p>
</th>
<th class="cellrowborder" valign="top" width="37.54%" id="mcps1.2.3.1.2"><p id="p191591616105219"><a name="p191591616105219"></a><a name="p191591616105219"></a>说明</p>
</th>
</tr>
</thead>
<tbody><tr id="row12159161615526"><td class="cellrowborder" valign="top" width="62.46000000000001%" headers="mcps1.2.3.1.1 "><p id="p2142175165213"><a name="p2142175165213"></a><a name="p2142175165213"></a>POST / HTTP/1.1</p>
<p id="p171425516524"><a name="p171425516524"></a><a name="p171425516524"></a>Host: examplebucket.obs.cn-north-4.myhuaweicloud.com</p>
<p id="p18143165165218"><a name="p18143165165218"></a><a name="p18143165165218"></a>Content-Type: multipart/form-data; boundary=---------------------------7e329d630b26</p>
<p id="p61431951155214"><a name="p61431951155214"></a><a name="p61431951155214"></a>Content-Length: 1597</p>
<p id="p12143551125212"><a name="p12143551125212"></a><a name="p12143551125212"></a></p>
<p id="p121431351195215"><a name="p121431351195215"></a><a name="p121431351195215"></a>-----------------------------7e32de17c166a</p>
<p id="p8143125118524"><a name="p8143125118524"></a><a name="p8143125118524"></a>Content-Disposition: form-data; name="key"</p>
<p id="p17143175115524"><a name="p17143175115524"></a><a name="p17143175115524"></a></p>
<p id="p41431151155214"><a name="p41431151155214"></a><a name="p41431151155214"></a>file/obj1</p>
<p id="p20143151165218"><a name="p20143151165218"></a><a name="p20143151165218"></a>-----------------------------7e32de17c166a</p>
<p id="p16143135135218"><a name="p16143135135218"></a><a name="p16143135135218"></a>Content-Disposition: form-data; name="AccessKeyId"</p>
<p id="p11143135116526"><a name="p11143135116526"></a><a name="p11143135116526"></a></p>
<p id="p4143551165216"><a name="p4143551165216"></a><a name="p4143551165216"></a>UYNVCM2JJES4APB9FZUG</p>
<p id="p6143351195211"><a name="p6143351195211"></a><a name="p6143351195211"></a>-----------------------------7e32de17c166a</p>
<p id="p1914395120521"><a name="p1914395120521"></a><a name="p1914395120521"></a>Content-Disposition: form-data; name="policy"</p>
<p id="p52671318131519"><a name="p52671318131519"></a><a name="p52671318131519"></a></p>
<p id="p85698216148"><a name="p85698216148"></a><a name="p85698216148"></a>ewogICJleHBpcmF0aW9uIjogIjIwMjAtMTAtMDFUMTI6MDA6MDAuMDAwWiIsCiAgImNvbmRpdGlvbnMiOiBbCiAgICB7ImJ1Y2tldCI6ICJleGFtcGxlYnVja2V0In0sCiAgICBbImVxIiwgIiRrZXkiLCAiZmlsZS9vYmoxIl0KICBdLAogICJjYWxsYmFjayI6IFsKICAgIHsidXJsIjogImh0dHA6Ly93d3cuZXhhbXBsZS5jb20vY2FsbGJhY2sifSwKICAgIHsiYm9keSI6ICJleUpyWlhraU9pSWtLR3RsZVNraUxDSm9ZWE5vSWpvaUpDaGxkR0ZuS1NKOSJ9LAogICAgeyJib2R5LXR5cGUiOiAiYXBwbGljYXRpb24vanNvbiJ9CiAgICBdCn0</p>
<p id="p1514418512525"><a name="p1514418512525"></a><a name="p1514418512525"></a>-----------------------------7e32de17c166a</p>
<p id="p19144251135218"><a name="p19144251135218"></a><a name="p19144251135218"></a>Content-Disposition: form-data; name="signature"</p>
<p id="p61441951105211"><a name="p61441951105211"></a><a name="p61441951105211"></a></p>
<p id="p10144151135211"><a name="p10144151135211"></a><a name="p10144151135211"></a>w0nW7iiC4Wfav9SXkU/NiSI99E8=</p>
<p id="p191441251165211"><a name="p191441251165211"></a><a name="p191441251165211"></a>-----------------------------7e32de17c166a</p>
<p id="p1314415145218"><a name="p1314415145218"></a><a name="p1314415145218"></a>Content-Disposition: form-data; name="file"; filename="E:\TEST_FILE\TEST.txt"</p>
<p id="p13144195111522"><a name="p13144195111522"></a><a name="p13144195111522"></a>Content-Type: text/plain</p>
<p id="p4144185113527"><a name="p4144185113527"></a><a name="p4144185113527"></a></p>
<p id="p114445116529"><a name="p114445116529"></a><a name="p114445116529"></a>123456</p>
<p id="p20144195125219"><a name="p20144195125219"></a><a name="p20144195125219"></a>---------------------------7e32de17c166a</p>
<p id="p1144175145212"><a name="p1144175145212"></a><a name="p1144175145212"></a>Content-Disposition: form-data; name="submit"</p>
<p id="p4144151145211"><a name="p4144151145211"></a><a name="p4144151145211"></a></p>
<p id="p61443518523"><a name="p61443518523"></a><a name="p61443518523"></a>Upload</p>
<p id="p13144115119525"><a name="p13144115119525"></a><a name="p13144115119525"></a>-----------------------------7e32de17c166a--</p>
</td>
<td class="cellrowborder" valign="top" width="37.54%" headers="mcps1.2.3.1.2 "><p id="p171131985314"><a name="p171131985314"></a><a name="p171131985314"></a>其中policy为：</p>
<p id="p85117281159"><a name="p85117281159"></a><a name="p85117281159"></a>{</p>
<p id="p45122815155"><a name="p45122815155"></a><a name="p45122815155"></a>"expiration": "2020-10-01T12:00:00.000Z",</p>
<p id="p35122811516"><a name="p35122811516"></a><a name="p35122811516"></a>"conditions": [</p>
<p id="p1551428121512"><a name="p1551428121512"></a><a name="p1551428121512"></a>{"bucket": "examplebucket"},</p>
<p id="p951628161510"><a name="p951628161510"></a><a name="p951628161510"></a>["eq", "$key", "file/obj1"]</p>
<p id="p155102801518"><a name="p155102801518"></a><a name="p155102801518"></a>],</p>
<p id="p135162881512"><a name="p135162881512"></a><a name="p135162881512"></a>"callback": [</p>
<p id="p1751112801520"><a name="p1751112801520"></a><a name="p1751112801520"></a>{"url": "http://www.example.com/callback"},</p>
<p id="p16518281155"><a name="p16518281155"></a><a name="p16518281155"></a>{"body": "eyJrZXkiOiIkKGtleSkiLCJoYXNoIjoiJChldGFnKSJ9"},</p>
<p id="p05218284158"><a name="p05218284158"></a><a name="p05218284158"></a>{"body-type": "application/json"}</p>
<p id="p105212815153"><a name="p105212815153"></a><a name="p105212815153"></a>]</p>
<p id="p052162861510"><a name="p052162861510"></a><a name="p052162861510"></a>}</p>
<p id="p821719195310"><a name="p821719195310"></a><a name="p821719195310"></a>回调body为：</p>
<p id="p1575415479158"><a name="p1575415479158"></a><a name="p1575415479158"></a>{"key":"$(key)","hash":"$(etag)"}</p>
<p id="p8251965312"><a name="p8251965312"></a><a name="p8251965312"></a>其中系统变量key=file/obj1，etag=f447b20a7fcbf53a5d5be013ea0b15af，最终回调的消息体是：</p>
<p id="p14271905317"><a name="p14271905317"></a><a name="p14271905317"></a>{"key":"file/obj1","hash":"f447b20a7fcbf53a5d5be013ea0b15af"}</p>
</td>
</tr>
</tbody>
</table>

**表 6**  通过表单携带回调参数，回调请求中只使用系统变量

<a name="table187105975819"></a>
<table><thead align="left"><tr id="row1171159145813"><th class="cellrowborder" valign="top" width="62.49%" id="mcps1.2.3.1.1"><p id="p4712599587"><a name="p4712599587"></a><a name="p4712599587"></a>请求</p>
</th>
<th class="cellrowborder" valign="top" width="37.51%" id="mcps1.2.3.1.2"><p id="p18825995814"><a name="p18825995814"></a><a name="p18825995814"></a>说明</p>
</th>
</tr>
</thead>
<tbody><tr id="row168165919582"><td class="cellrowborder" valign="top" width="62.49%" headers="mcps1.2.3.1.1 "><p id="p10356144418192"><a name="p10356144418192"></a><a name="p10356144418192"></a>POST / HTTP/1.1</p>
<p id="p5356194481917"><a name="p5356194481917"></a><a name="p5356194481917"></a>Host: examplebucket.obs.cn-north-4.myhuaweicloud.com</p>
<p id="p93571544181918"><a name="p93571544181918"></a><a name="p93571544181918"></a>Content-Type: multipart/form-data; boundary=---------------------------7e329d630b26</p>
<p id="p33571444131917"><a name="p33571444131917"></a><a name="p33571444131917"></a>Content-Length: 1597</p>
<p id="p1735784418193"><a name="p1735784418193"></a><a name="p1735784418193"></a></p>
<p id="p635714446194"><a name="p635714446194"></a><a name="p635714446194"></a>-----------------------------7e32de17c166a</p>
<p id="p1435714461915"><a name="p1435714461915"></a><a name="p1435714461915"></a>Content-Disposition: form-data; name="key"</p>
<p id="p935794491913"><a name="p935794491913"></a><a name="p935794491913"></a></p>
<p id="p035724431918"><a name="p035724431918"></a><a name="p035724431918"></a>file/obj1</p>
<p id="p1335784420197"><a name="p1335784420197"></a><a name="p1335784420197"></a>-----------------------------7e32de17c166a</p>
<p id="p9357174451914"><a name="p9357174451914"></a><a name="p9357174451914"></a>Content-Disposition: form-data; name="AccessKeyId"</p>
<p id="p135794417195"><a name="p135794417195"></a><a name="p135794417195"></a></p>
<p id="p1035754471918"><a name="p1035754471918"></a><a name="p1035754471918"></a>UYNVCM2JJES4APB9FZUG</p>
<p id="p2357184412192"><a name="p2357184412192"></a><a name="p2357184412192"></a>-----------------------------7e32de17c166a</p>
<p id="p6357114418192"><a name="p6357114418192"></a><a name="p6357114418192"></a>Content-Disposition: form-data; name="policy"</p>
<p id="p1235713449196"><a name="p1235713449196"></a><a name="p1235713449196"></a></p>
<p id="p1335713441193"><a name="p1335713441193"></a><a name="p1335713441193"></a>ewogICJleHBpcmF0aW9uIjogIjIwMjAtMTAtMDFUMTI6MDA6MDAuMDAwWiIsCiAgImNvbmRpdGlvbnMiOiBbCiAgICB7ImJ1Y2tldCI6ICJleGFtcGxlYnVja2V0In0sCiAgICBbImVxIiwgIiRrZXkiLCAiZmlsZS9vYmoxIl0KICBdCn0</p>
<p id="p13357184415195"><a name="p13357184415195"></a><a name="p13357184415195"></a>-----------------------------7e32de17c166a</p>
<p id="p835724415196"><a name="p835724415196"></a><a name="p835724415196"></a>Content-Disposition: form-data; name="signature"</p>
<p id="p18357944151911"><a name="p18357944151911"></a><a name="p18357944151911"></a></p>
<p id="p1035704414195"><a name="p1035704414195"></a><a name="p1035704414195"></a>w0nW7iiC4Wfav9SXkU/NiSI99E8=</p>
<p id="p16357104411919"><a name="p16357104411919"></a><a name="p16357104411919"></a>-----------------------------7e32de17c166a</p>
<p id="p3357194412194"><a name="p3357194412194"></a><a name="p3357194412194"></a>Content-Disposition: form-data; name="callbackUrl"</p>
<p id="p15357344111917"><a name="p15357344111917"></a><a name="p15357344111917"></a></p>
<p id="p23576449193"><a name="p23576449193"></a><a name="p23576449193"></a>http://my.callback.com:8080/api/callback</p>
<p id="p335720449191"><a name="p335720449191"></a><a name="p335720449191"></a>-----------------------------7e32de17c166a</p>
<p id="p17357344161914"><a name="p17357344161914"></a><a name="p17357344161914"></a>Content-Disposition: form-data; name="callbackBody"</p>
<p id="p23571544121917"><a name="p23571544121917"></a><a name="p23571544121917"></a></p>
<p id="p735714421914"><a name="p735714421914"></a><a name="p735714421914"></a>key=$(key)&amp;hash=$(etag)&amp;fname=$(fname)&amp;fsize=$(size)</p>
<p id="p93571744111916"><a name="p93571744111916"></a><a name="p93571744111916"></a>-----------------------------7e32de17c166a</p>
<p id="p735784419199"><a name="p735784419199"></a><a name="p735784419199"></a>Content-Disposition: form-data; name="file"; filename="E:\TEST_FILE\TEST.txt"</p>
<p id="p153576446196"><a name="p153576446196"></a><a name="p153576446196"></a>Content-Type: text/plain</p>
<p id="p1735710445191"><a name="p1735710445191"></a><a name="p1735710445191"></a></p>
<p id="p18357164481910"><a name="p18357164481910"></a><a name="p18357164481910"></a>123456</p>
<p id="p113577446197"><a name="p113577446197"></a><a name="p113577446197"></a>---------------------------7e32de17c166a</p>
<p id="p1135724413193"><a name="p1135724413193"></a><a name="p1135724413193"></a>Content-Disposition: form-data; name="submit"</p>
<p id="p4357164491915"><a name="p4357164491915"></a><a name="p4357164491915"></a></p>
<p id="p1335754416199"><a name="p1335754416199"></a><a name="p1335754416199"></a>Upload</p>
<p id="p1357204416194"><a name="p1357204416194"></a><a name="p1357204416194"></a>-----------------------------7e32de17c166a--</p>
</td>
<td class="cellrowborder" valign="top" width="37.51%" headers="mcps1.2.3.1.2 "><p id="p88175955810"><a name="p88175955810"></a><a name="p88175955810"></a>其中policy为：</p>
<p id="p119105510194"><a name="p119105510194"></a><a name="p119105510194"></a>{</p>
<p id="p019125519194"><a name="p019125519194"></a><a name="p019125519194"></a>"expiration": "2020-10-01T12:00:00.000Z",</p>
<p id="p131918551193"><a name="p131918551193"></a><a name="p131918551193"></a>"conditions": [</p>
<p id="p11925591914"><a name="p11925591914"></a><a name="p11925591914"></a>{"bucket": "examplebucket"},</p>
<p id="p1419455151916"><a name="p1419455151916"></a><a name="p1419455151916"></a>["eq", "$key", "file/obj1"]</p>
<p id="p41995516192"><a name="p41995516192"></a><a name="p41995516192"></a>]</p>
<p id="p11915541912"><a name="p11915541912"></a><a name="p11915541912"></a>}</p>
<p id="p1147767153918"><a name="p1147767153918"></a><a name="p1147767153918"></a>policy中可以不包含callbackUrl和callbackBody这两个回调参数。bucket、key为必须包含的表单元素。</p>
<p id="p19180421183913"><a name="p19180421183913"></a><a name="p19180421183913"></a></p>
<p id="p7968192112231"><a name="p7968192112231"></a><a name="p7968192112231"></a>回调body为：</p>
<p id="p423518415428"><a name="p423518415428"></a><a name="p423518415428"></a>key=$(key)&amp;hash=$(etag)&amp;fname=$(fname)&amp;fsize=$(size)</p>
<p id="p711163318237"><a name="p711163318237"></a><a name="p711163318237"></a>其中系统变量key=file/obj1，etag=f447b20a7fcbf53a5d5be013ea0b15af，fname=E:\TEST_FILE\TEST.txt，fsize=7。</p>
<p id="p88819358428"><a name="p88819358428"></a><a name="p88819358428"></a>最终回调的消息体是：</p>
<p id="p79081732134211"><a name="p79081732134211"></a><a name="p79081732134211"></a>key=file/obj1&amp;hash=f447b20a7fcbf53a5d5be013ea0b15af&amp;fname=E:\TEST_FILE\TEST.txt&amp;fsize=7。</p>
</td>
</tr>
</tbody>
</table>

**表 7**  通过表单携带回调参数，回调请求中使用系统变量和自定义变量，同时设置自定义元数据

<a name="table8736022312"></a>
<table><thead align="left"><tr id="row107420152318"><th class="cellrowborder" valign="top" width="62.68%" id="mcps1.2.3.1.1"><p id="p17741000233"><a name="p17741000233"></a><a name="p17741000233"></a>请求</p>
</th>
<th class="cellrowborder" valign="top" width="37.32%" id="mcps1.2.3.1.2"><p id="p07430152319"><a name="p07430152319"></a><a name="p07430152319"></a>说明</p>
</th>
</tr>
</thead>
<tbody><tr id="row474509239"><td class="cellrowborder" valign="top" width="62.68%" headers="mcps1.2.3.1.1 "><p id="p10817322194315"><a name="p10817322194315"></a><a name="p10817322194315"></a>POST / HTTP/1.1</p>
<p id="p081752212439"><a name="p081752212439"></a><a name="p081752212439"></a>Host: examplebucket.obs.cn-north-4.myhuaweicloud.com</p>
<p id="p18817152244315"><a name="p18817152244315"></a><a name="p18817152244315"></a>Content-Type: multipart/form-data; boundary=---------------------------7e329d630b26</p>
<p id="p68175228436"><a name="p68175228436"></a><a name="p68175228436"></a>Content-Length: 1597</p>
<p id="p781716224439"><a name="p781716224439"></a><a name="p781716224439"></a></p>
<p id="p1581713226434"><a name="p1581713226434"></a><a name="p1581713226434"></a>-----------------------------7e32de17c166a</p>
<p id="p3817152211434"><a name="p3817152211434"></a><a name="p3817152211434"></a>Content-Disposition: form-data; name="key"</p>
<p id="p12817102274317"><a name="p12817102274317"></a><a name="p12817102274317"></a></p>
<p id="p481792234317"><a name="p481792234317"></a><a name="p481792234317"></a>file/obj1</p>
<p id="p8817112214313"><a name="p8817112214313"></a><a name="p8817112214313"></a>-----------------------------7e32de17c166a</p>
<p id="p16817172294310"><a name="p16817172294310"></a><a name="p16817172294310"></a>Content-Disposition: form-data; name="AccessKeyId"</p>
<p id="p19817112274315"><a name="p19817112274315"></a><a name="p19817112274315"></a></p>
<p id="p7817822164312"><a name="p7817822164312"></a><a name="p7817822164312"></a>UYNVCM2JJES4APB9FZUG</p>
<p id="p1981842213438"><a name="p1981842213438"></a><a name="p1981842213438"></a>-----------------------------7e32de17c166a</p>
<p id="p7818022124315"><a name="p7818022124315"></a><a name="p7818022124315"></a>Content-Disposition: form-data; name="policy"</p>
<p id="p178183226435"><a name="p178183226435"></a><a name="p178183226435"></a></p>
<p id="p2818922134316"><a name="p2818922134316"></a><a name="p2818922134316"></a>ewogICJleHBpcmF0aW9uIjogIjIwMjAtMTAtMDFUMTI6MDA6MDAuMDAwWiIsCiAgImNvbmRpdGlvbnMiOiBbCiAgICB7ImJ1Y2tldCI6ICJleGFtcGxlYnVja2V0In0sCiAgICBbImVxIiwgIiRrZXkiLCAiZmlsZS9vYmoxIl0sCgl7Ingtb2JzLW1ldGEtdGVzdDEiOiJ2YWx1ZTEifQogIF0KfQ</p>
<p id="p158182222439"><a name="p158182222439"></a><a name="p158182222439"></a>-----------------------------7e32de17c166a</p>
<p id="p1281814226437"><a name="p1281814226437"></a><a name="p1281814226437"></a>Content-Disposition: form-data; name="signature"</p>
<p id="p1781842284315"><a name="p1781842284315"></a><a name="p1781842284315"></a></p>
<p id="p1381802214318"><a name="p1381802214318"></a><a name="p1381802214318"></a>w0nW7iiC4Wfav9SXkU/NiSI99E8=</p>
<p id="p19222039473"><a name="p19222039473"></a><a name="p19222039473"></a>-----------------------------7e32de17c166a</p>
<p id="p1520294522915"><a name="p1520294522915"></a><a name="p1520294522915"></a>Content-Disposition: form-data; name="x-obs-meta-test1"</p>
<p id="p420213458294"><a name="p420213458294"></a><a name="p420213458294"></a></p>
<p id="p13202045172911"><a name="p13202045172911"></a><a name="p13202045172911"></a>value1</p>
<p id="p3818132218437"><a name="p3818132218437"></a><a name="p3818132218437"></a>-----------------------------7e32de17c166a</p>
<p id="p9818132217435"><a name="p9818132217435"></a><a name="p9818132217435"></a>Content-Disposition: form-data; name="callbackUrl"</p>
<p id="p881882216433"><a name="p881882216433"></a><a name="p881882216433"></a></p>
<p id="p581862215437"><a name="p581862215437"></a><a name="p581862215437"></a>http://my.callback.com:8080/api/callback</p>
<p id="p88181522164312"><a name="p88181522164312"></a><a name="p88181522164312"></a>-----------------------------7e32de17c166a</p>
<p id="p281832294312"><a name="p281832294312"></a><a name="p281832294312"></a>Content-Disposition: form-data; name="callbackBody"</p>
<p id="p081812223435"><a name="p081812223435"></a><a name="p081812223435"></a></p>
<p id="p19818622154313"><a name="p19818622154313"></a><a name="p19818622154313"></a>{"bucketName": "$(bucket)","key": "$(key)","hash": "$(etag)","id": "${x:id}","createtime": "${x:time}"}</p>
<p id="p9673174310439"><a name="p9673174310439"></a><a name="p9673174310439"></a>-----------------------------7e32de17c166a</p>
<p id="p2067416438437"><a name="p2067416438437"></a><a name="p2067416438437"></a>Content-Disposition: form-data; name="callbackHost"</p>
<p id="p686365964910"><a name="p686365964910"></a><a name="p686365964910"></a></p>
<p id="p112801457174918"><a name="p112801457174918"></a><a name="p112801457174918"></a>my.callback.com</p>
<p id="p8501164734315"><a name="p8501164734315"></a><a name="p8501164734315"></a>-----------------------------7e32de17c166a</p>
<p id="p1550114711433"><a name="p1550114711433"></a><a name="p1550114711433"></a>Content-Disposition: form-data; name="callbackBodyType"</p>
<p id="p13942216194918"><a name="p13942216194918"></a><a name="p13942216194918"></a></p>
<p id="p1882118819490"><a name="p1882118819490"></a><a name="p1882118819490"></a>application/json</p>
<p id="p1235711248573"><a name="p1235711248573"></a><a name="p1235711248573"></a>-----------------------------7e32de17c166a</p>
<p id="p153572242571"><a name="p153572242571"></a><a name="p153572242571"></a>Content-Disposition: form-data; name="x:id"</p>
<p id="p13357162455720"><a name="p13357162455720"></a><a name="p13357162455720"></a></p>
<p id="p1035792416576"><a name="p1035792416576"></a><a name="p1035792416576"></a>test-example-id</p>
<p id="p1531122617573"><a name="p1531122617573"></a><a name="p1531122617573"></a>-----------------------------7e32de17c166a</p>
<p id="p1631102675714"><a name="p1631102675714"></a><a name="p1631102675714"></a>Content-Disposition: form-data; name="x:time"</p>
<p id="p431526115717"><a name="p431526115717"></a><a name="p431526115717"></a></p>
<p id="p1331142619576"><a name="p1331142619576"></a><a name="p1331142619576"></a>2019-12-06 18:01:34</p>
<p id="p148181022124319"><a name="p148181022124319"></a><a name="p148181022124319"></a>-----------------------------7e32de17c166a</p>
<p id="p1581892224319"><a name="p1581892224319"></a><a name="p1581892224319"></a>Content-Disposition: form-data; name="file"; filename="E:\TEST_FILE\TEST.txt"</p>
<p id="p5818922124316"><a name="p5818922124316"></a><a name="p5818922124316"></a>Content-Type: text/plain</p>
<p id="p1381842274319"><a name="p1381842274319"></a><a name="p1381842274319"></a></p>
<p id="p68185225436"><a name="p68185225436"></a><a name="p68185225436"></a>123456</p>
<p id="p18818162219437"><a name="p18818162219437"></a><a name="p18818162219437"></a>---------------------------7e32de17c166a</p>
<p id="p8818822134312"><a name="p8818822134312"></a><a name="p8818822134312"></a>Content-Disposition: form-data; name="submit"</p>
<p id="p1281842294312"><a name="p1281842294312"></a><a name="p1281842294312"></a></p>
<p id="p381818225433"><a name="p381818225433"></a><a name="p381818225433"></a>Upload</p>
<p id="p48181622134312"><a name="p48181622134312"></a><a name="p48181622134312"></a>-----------------------------7e32de17c166a--</p>
</td>
<td class="cellrowborder" valign="top" width="37.32%" headers="mcps1.2.3.1.2 "><p id="p799417173599"><a name="p799417173599"></a><a name="p799417173599"></a>其中policy为：</p>
<p id="p8994717205919"><a name="p8994717205919"></a><a name="p8994717205919"></a>{</p>
<p id="p4994101745911"><a name="p4994101745911"></a><a name="p4994101745911"></a>"expiration": "2020-10-01T12:00:00.000Z",</p>
<p id="p1899461715912"><a name="p1899461715912"></a><a name="p1899461715912"></a>"conditions": [</p>
<p id="p99941317165916"><a name="p99941317165916"></a><a name="p99941317165916"></a>{"bucket": "examplebucket"},</p>
<p id="p1699416179598"><a name="p1699416179598"></a><a name="p1699416179598"></a>["eq", "$key", "file/obj1"],</p>
<p id="p1623218359303"><a name="p1623218359303"></a><a name="p1623218359303"></a>{"x-obs-meta-test1":"value1"}</p>
<p id="p1099419176593"><a name="p1099419176593"></a><a name="p1099419176593"></a>]</p>
<p id="p799531718591"><a name="p799531718591"></a><a name="p799531718591"></a>}</p>
<p id="p752820337393"><a name="p752820337393"></a><a name="p752820337393"></a>policy中可以不包含callbackUrl、callbackBody、callbackHost、callbackBodyType、x:id、x:time这六个回调参数。bucket、key、x-obs-meta-test1为必须包含的表单元素。</p>
<p id="p384153423914"><a name="p384153423914"></a><a name="p384153423914"></a></p>
<p id="p69951917155913"><a name="p69951917155913"></a><a name="p69951917155913"></a>回调body为：</p>
<p id="p109218129011"><a name="p109218129011"></a><a name="p109218129011"></a>{"bucketName": "$(bucket)","key": "$(key)","hash": "$(etag)","id": "${x:id}","createtime": "${x:time}"}</p>
<p id="p699531715596"><a name="p699531715596"></a><a name="p699531715596"></a>其中系统变量bucket=examplebucket，key=file/obj1，etag=f447b20a7fcbf53a5d5be013ea0b15af，自定义变量x:id=test-example-id，x:time=2019-12-06 18:01:34。</p>
<p id="p299512175592"><a name="p299512175592"></a><a name="p299512175592"></a>最终回调的json消息体是：</p>
<p id="p16512172115419"><a name="p16512172115419"></a><a name="p16512172115419"></a>{"bucketName": "examplebucket","key": "file/obj1","hash": "f447b20a7fcbf53a5d5be013ea0b15af","id": "test-example-id","createtime": "2019-12-06 18:01:34"}</p>
</td>
</tr>
</tbody>
</table>

**表 8**  通过表单携带回调参数，并且校验部分回调参数

<a name="table6654172712213"></a>
<table><thead align="left"><tr id="row5655627122110"><th class="cellrowborder" valign="top" width="62.77%" id="mcps1.2.3.1.1"><p id="p95633562221"><a name="p95633562221"></a><a name="p95633562221"></a>请求</p>
</th>
<th class="cellrowborder" valign="top" width="37.230000000000004%" id="mcps1.2.3.1.2"><p id="p12655122717219"><a name="p12655122717219"></a><a name="p12655122717219"></a>说明</p>
</th>
</tr>
</thead>
<tbody><tr id="row16551627162117"><td class="cellrowborder" valign="top" width="62.77%" headers="mcps1.2.3.1.1 "><p id="p133181152317"><a name="p133181152317"></a><a name="p133181152317"></a>POST / HTTP/1.1</p>
<p id="p153318111238"><a name="p153318111238"></a><a name="p153318111238"></a>Host: examplebucket.obs.cn-north-4.myhuaweicloud.com</p>
<p id="p18332161111235"><a name="p18332161111235"></a><a name="p18332161111235"></a>Content-Type: multipart/form-data; boundary=---------------------------7e329d630b26</p>
<p id="p733213115239"><a name="p733213115239"></a><a name="p733213115239"></a>Content-Length: 1597</p>
<p id="p0332171116232"><a name="p0332171116232"></a><a name="p0332171116232"></a></p>
<p id="p16332111110236"><a name="p16332111110236"></a><a name="p16332111110236"></a>-----------------------------7e32de17c166a</p>
<p id="p533271113233"><a name="p533271113233"></a><a name="p533271113233"></a>Content-Disposition: form-data; name="key"</p>
<p id="p13332115238"><a name="p13332115238"></a><a name="p13332115238"></a></p>
<p id="p4333201115237"><a name="p4333201115237"></a><a name="p4333201115237"></a>file/obj1</p>
<p id="p1333171112317"><a name="p1333171112317"></a><a name="p1333171112317"></a>-----------------------------7e32de17c166a</p>
<p id="p1533381110233"><a name="p1533381110233"></a><a name="p1533381110233"></a>Content-Disposition: form-data; name="AccessKeyId"</p>
<p id="p733351115235"><a name="p733351115235"></a><a name="p733351115235"></a></p>
<p id="p1633381102311"><a name="p1633381102311"></a><a name="p1633381102311"></a>UYNVCM2JJES4APB9FZUG</p>
<p id="p1833317116236"><a name="p1833317116236"></a><a name="p1833317116236"></a>-----------------------------7e32de17c166a</p>
<p id="p183334116232"><a name="p183334116232"></a><a name="p183334116232"></a>Content-Disposition: form-data; name="policy"</p>
<p id="p20333201162311"><a name="p20333201162311"></a><a name="p20333201162311"></a></p>
<p id="p103332113232"><a name="p103332113232"></a><a name="p103332113232"></a>eyJleHBpcmF0aW9uIjogIjIwMjAtMTAtMDFUMTI6MDA6MDAuMDAwWiIsImNvbmRpdGlvbnMiOiBbeyJidWNrZXQiOiAiZXhhbXBsZWJ1Y2tldCJ9LFsiZXEiLCAiJGtleSIsICJmaWxlL29iajEiXSx7Ingtb2JzLW1ldGEtdGVzdDEiOiJ2YWx1ZTEifSx7ImNhbGxiYWNrVXJsIjoiaHR0cDovL215LmNhbGxiYWNrLmNvbTo4MDgwL2FwaS9jYWxsYmFjayJ9LHsiY2FsbGJhY2tCb2R5Ijoie1wiYnVja2V0TmFtZVwiOiAkKGJ1Y2tldCksXCJrZXlcIjogJChrZXkpLFwiaGFzaFwiOiAkKGV0YWcpLFwiaWRcIjogJHt4OmlkfSxcImNyZWF0ZXRpbWVcIjogJHt4OnRpbWV9fSJ9LHsieDp0aW1lIjoiMjAxOS0xMi0wNiAxODowMTozNCJ9XX0</p>
<p id="p133361110234"><a name="p133361110234"></a><a name="p133361110234"></a>-----------------------------7e32de17c166a</p>
<p id="p11334211192316"><a name="p11334211192316"></a><a name="p11334211192316"></a>Content-Disposition: form-data; name="signature"</p>
<p id="p7334101118232"><a name="p7334101118232"></a><a name="p7334101118232"></a></p>
<p id="p1333461122313"><a name="p1333461122313"></a><a name="p1333461122313"></a>w0nW7iiC4Wfav9SXkU/NiSI99E8=</p>
<p id="p16334711152318"><a name="p16334711152318"></a><a name="p16334711152318"></a>-----------------------------7e32de17c166a</p>
<p id="p533451117238"><a name="p533451117238"></a><a name="p533451117238"></a>Content-Disposition: form-data; name="x-obs-meta-test1"</p>
<p id="p14334911102312"><a name="p14334911102312"></a><a name="p14334911102312"></a></p>
<p id="p43341911112318"><a name="p43341911112318"></a><a name="p43341911112318"></a>value1</p>
<p id="p133415117237"><a name="p133415117237"></a><a name="p133415117237"></a>-----------------------------7e32de17c166a</p>
<p id="p3334101112230"><a name="p3334101112230"></a><a name="p3334101112230"></a>Content-Disposition: form-data; name="callbackUrl"</p>
<p id="p11334711102310"><a name="p11334711102310"></a><a name="p11334711102310"></a></p>
<p id="p633431119234"><a name="p633431119234"></a><a name="p633431119234"></a>http://my.callback.com:8080/api/callback</p>
<p id="p15334101192317"><a name="p15334101192317"></a><a name="p15334101192317"></a>-----------------------------7e32de17c166a</p>
<p id="p73341711132313"><a name="p73341711132313"></a><a name="p73341711132313"></a>Content-Disposition: form-data; name="callbackBody"</p>
<p id="p183341911202318"><a name="p183341911202318"></a><a name="p183341911202318"></a></p>
<p id="p19334311112311"><a name="p19334311112311"></a><a name="p19334311112311"></a>{"bucketName": $(bucket),"key": $(key),"hash": $(etag),"id": ${x:id},"createtime": ${x:time}}</p>
<p id="p2334151115239"><a name="p2334151115239"></a><a name="p2334151115239"></a>-----------------------------7e32de17c166a</p>
<p id="p93347111232"><a name="p93347111232"></a><a name="p93347111232"></a>Content-Disposition: form-data; name="callbackHost"</p>
<p id="p933481182319"><a name="p933481182319"></a><a name="p933481182319"></a></p>
<p id="p8334171152311"><a name="p8334171152311"></a><a name="p8334171152311"></a>my.callback.com</p>
<p id="p4334111162314"><a name="p4334111162314"></a><a name="p4334111162314"></a>-----------------------------7e32de17c166a</p>
<p id="p1233401115235"><a name="p1233401115235"></a><a name="p1233401115235"></a>Content-Disposition: form-data; name="callbackBodyType"</p>
<p id="p11334111116239"><a name="p11334111116239"></a><a name="p11334111116239"></a></p>
<p id="p193351118233"><a name="p193351118233"></a><a name="p193351118233"></a>application/json</p>
<p id="p11335161102314"><a name="p11335161102314"></a><a name="p11335161102314"></a>-----------------------------7e32de17c166a</p>
<p id="p1433541122311"><a name="p1433541122311"></a><a name="p1433541122311"></a>Content-Disposition: form-data; name="x:id"</p>
<p id="p13335911162312"><a name="p13335911162312"></a><a name="p13335911162312"></a></p>
<p id="p13351711142315"><a name="p13351711142315"></a><a name="p13351711142315"></a>test-example-id</p>
<p id="p4335101112314"><a name="p4335101112314"></a><a name="p4335101112314"></a>-----------------------------7e32de17c166a</p>
<p id="p8335181112237"><a name="p8335181112237"></a><a name="p8335181112237"></a>Content-Disposition: form-data; name="x:time"</p>
<p id="p14335181118236"><a name="p14335181118236"></a><a name="p14335181118236"></a></p>
<p id="p533519111238"><a name="p533519111238"></a><a name="p533519111238"></a>2019-12-06 18:01:34</p>
<p id="p133351611172320"><a name="p133351611172320"></a><a name="p133351611172320"></a>-----------------------------7e32de17c166a</p>
<p id="p8335141172318"><a name="p8335141172318"></a><a name="p8335141172318"></a>Content-Disposition: form-data; name="file"; filename="E:\TEST_FILE\TEST.txt"</p>
<p id="p1533571132311"><a name="p1533571132311"></a><a name="p1533571132311"></a>Content-Type: text/plain</p>
<p id="p1233511116230"><a name="p1233511116230"></a><a name="p1233511116230"></a></p>
<p id="p1833514117235"><a name="p1833514117235"></a><a name="p1833514117235"></a>123456</p>
<p id="p6335611102317"><a name="p6335611102317"></a><a name="p6335611102317"></a>---------------------------7e32de17c166a</p>
<p id="p1133571112317"><a name="p1133571112317"></a><a name="p1133571112317"></a>Content-Disposition: form-data; name="submit"</p>
<p id="p1533541114239"><a name="p1533541114239"></a><a name="p1533541114239"></a></p>
<p id="p4335151112236"><a name="p4335151112236"></a><a name="p4335151112236"></a>Upload</p>
<p id="p103351711132313"><a name="p103351711132313"></a><a name="p103351711132313"></a>-----------------------------7e32de17c166a--</p>
</td>
<td class="cellrowborder" valign="top" width="37.230000000000004%" headers="mcps1.2.3.1.2 "><p id="p219853019238"><a name="p219853019238"></a><a name="p219853019238"></a>其中policy为：</p>
<p id="p8199173062311"><a name="p8199173062311"></a><a name="p8199173062311"></a>{</p>
<p id="p13199113082320"><a name="p13199113082320"></a><a name="p13199113082320"></a>"expiration": "2020-10-01T12:00:00.000Z",</p>
<p id="p51996301237"><a name="p51996301237"></a><a name="p51996301237"></a>"conditions": [</p>
<p id="p7199173062313"><a name="p7199173062313"></a><a name="p7199173062313"></a>{"bucket": "examplebucket"},</p>
<p id="p1519993032316"><a name="p1519993032316"></a><a name="p1519993032316"></a>["eq", "$key", "file/obj1"],</p>
<p id="p18199830182317"><a name="p18199830182317"></a><a name="p18199830182317"></a>{"x-obs-meta-test1":"value1"},</p>
<p id="p173310587236"><a name="p173310587236"></a><a name="p173310587236"></a>{"callbackUrl":"http://my.callback.com:8080/api/callback"},</p>
<p id="p539117401244"><a name="p539117401244"></a><a name="p539117401244"></a>{"callbackBody":"{\"bucketName\": $(bucket),\"key\": $(key),\"hash\": $(etag),\"id\": ${x:id},\"createtime\": ${x:time}}"},</p>
<p id="p13519108113714"><a name="p13519108113714"></a><a name="p13519108113714"></a>{"x:time":"2019-12-06 18:01:34"}</p>
<p id="p019933072311"><a name="p019933072311"></a><a name="p019933072311"></a>]</p>
<p id="p019913309237"><a name="p019913309237"></a><a name="p019913309237"></a>}</p>
<p id="p11439682460"><a name="p11439682460"></a><a name="p11439682460"></a>policy中包含了callbackUrl、callbackBody、x:time这三个回调参数，会对这三个参数做条件校验，没有包含callbackHost、callbackBodyType、x:id这三个回调参数，不对这三个参数做条件校验。</p>
<p id="p36374566456"><a name="p36374566456"></a><a name="p36374566456"></a>policy中可以不包含回调参数，也可以包含部分/全部回调参数。</p>
<p id="p1647820298442"><a name="p1647820298442"></a><a name="p1647820298442"></a>bucket、key、x-obs-meta-test1为必须包含的表单元素。</p>
<p id="p2741193014446"><a name="p2741193014446"></a><a name="p2741193014446"></a></p>
<p id="p1119923011237"><a name="p1119923011237"></a><a name="p1119923011237"></a>回调body为：</p>
<p id="p2199183014239"><a name="p2199183014239"></a><a name="p2199183014239"></a>{"bucketName": $(bucket),"key": $(key),"hash": $(etag),"id": ${x:id},"createtime": ${x:time}}</p>
<p id="p8199830152320"><a name="p8199830152320"></a><a name="p8199830152320"></a>其中系统变量bucket=examplebucket，key=file/obj1，etag=f447b20a7fcbf53a5d5be013ea0b15af，自定义变量x:id=test-example-id，x:time=2019-12-06 18:01:34。</p>
<p id="p3199330152316"><a name="p3199330152316"></a><a name="p3199330152316"></a>最终回调的json消息体是：</p>
<p id="p51999306236"><a name="p51999306236"></a><a name="p51999306236"></a>{"bucketName": "examplebucket","key": "file/obj1","hash": "f447b20a7fcbf53a5d5be013ea0b15af","id": "test-example-id","createtime": "2019-12-06 18:01:34"}</p>
</td>
</tr>
</tbody>
</table>

