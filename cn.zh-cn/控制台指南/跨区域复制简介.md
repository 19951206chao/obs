# 跨区域复制简介<a name="obs_03_0002"></a>

跨区域复制能够为用户提供跨区域数据容灾的能力，满足用户数据复制到异地进行备份的需求。

跨区域复制是指通过创建跨区域复制规则，在同一个账号下，将一个桶（源桶）中的数据自动、异步地复制到不同区域的另外一个桶（目标桶）中。

在配置跨区域复制规则时，您可以按前缀匹配请求复制部分对象，也可以请求复制桶中的所有对象。复制到目标桶的对象是源桶中对象的精确副本。它们具有相同的对象名称和元数据，包括：对象内容、大小、最后修改时间、创建者、版本号、用户定义的元数据以及ACL。默认情况下复制对象的存储类别，与源对象保持一致。您也可以为复制对象指定一个存储类别。

**图 1**  跨区域复制示意图<a name="fig1334119194217"></a>  
![](figures/跨区域复制示意图.png "跨区域复制示意图")

## 复制的内容<a name="section6567154394516"></a>

启用跨区域复制规则后，符合以下条件的对象会复制到目标桶中：

-   新上传的对象（归档存储对象除外）。
-   有更新的对象，比如对象内容有更新或者已复制成功的对象ACL有更新。
-   桶中的历史对象（需要开启“同步历史对象”功能）。

## 适用场景<a name="section50131461181156"></a>

-   客户需要在多地访问相同的OBS资源。为了最大限度缩短访问对象时的延迟，您可以使用跨区域复制，在离客户较近的区域中创建对象副本。
-   由于业务原因，您需要将OBS数据从一个区域的数据中心迁移至另一个区域的数据中心。
-   出于对数据安全性以及可用性的考虑，您希望对所有写入OBS的数据，都在另一个区域的数据中心显式地创建一个备份，以防止在数据发生不可逆损毁时，有安全、可用的备份数据。

## 约束与限制<a name="section14840141181339"></a>

在使用跨区域复制过程中，存在如下的约束与限制：

-   桶版本号为3.0及以上的桶支持跨区域复制功能。桶版本号可以在OBS管理控制台上，进入桶概览页后，在“基本信息”中查看。
-   启用跨区域复制功能之前上传的对象，默认不会被复制到目标桶，除非开启了“同步历史对象”功能。
-   源桶和目标桶必须属于不同的区域，同区域的桶不能进行数据复制。
-   源桶中归档存储类型的对象不支持跨区域复制到目标桶。
-   如果目标桶所属区域不支持存储类别，则复制后对象的存储类别均为标准存储类型。
-   源桶和目标桶的多版本控制状态必须保持一致。
-   源桶中的对象只能被复制到一个目标桶中，且复制过去的对象不能再被复制到另外一个目标桶。
-   当且仅当源桶、目标桶多版本控制状态开启，在源桶中不指定版本删除对象时，目标桶会同步删除此对象；除此之外，删除源桶对象时，目标桶默认不会同步删除操作。
-   在启用跨区域复制过程中，若您修改目标桶的多版本控制状态，会导致对象复制失败；若您尝试修改源桶多版本控制状态，必须先删除复制配置，然后才能进行修改。
-   源桶或目标桶都需要一直保证桶拥有者具有读写权限，以确保数据能够成功同步。如果源桶或目标桶的读写权限错误，导致系统没有读源对象或者写目标对象的权限，这种对象将一直复制不成功，即使将权限修改正确后，也不会重新复制。
-   如果源桶拥有者与对象拥有者不同，则对象拥有者必须通过对象ACL向源桶拥有者授予READ和READ\_ACP权限；如果目标桶拥有者与源桶拥有者不同，需要目标桶拥有者通过桶策略向源桶拥有者授予ReplicateObject和ReplicateDelete权限。
-   同一个源桶只能创建一条复制所有对象的跨区域复制规则，或多条（最多100条）按前缀匹配的跨区域复制规则。
-   OBS目前仅支持一个源桶同时复制到一个目标桶，不支持一个源桶同时复制到多个目标桶。允许修改目标桶，但修改目标桶会更改所有已创建规则的目标桶。
-   在启用跨区域复制过程中，若您删掉OBS云服务委托，会导致对象复制状态为FAILED。
-   不建议您对目标桶中的副本对象进行删除、覆盖或者修改ACL操作，此类操作可能导致目标桶中对象最新版本或者对象访问控制权限与源区域不一致。
-   启用历史对象复制后，修改跨区域复制配置可能导致历史对象不复制，建议在历史对象复制完成前不要改变该桶的跨区域复制配置。

